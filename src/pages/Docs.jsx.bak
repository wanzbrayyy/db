import { Link } from 'react-router-dom';
import { Book, ChevronRight, Code, Terminal, Server, Key, Shield, HardHat, FileText, Database, Code2 } from 'lucide-react';
import Card from '../components/ui/Card';

// Helper untuk menyembunyikan logika pewarnaan dari parser JSX
const getHighlightedCode = (code) => {
    // Ini adalah cara aman untuk melakukan Syntax Highlighting Sederhana
    // Menggunakan regex untuk mewarnai keyword dan string
    code = code.replace(/await|const|import|from|new|return|try|catch|function|export|class|this|if|else/g, '<span style="color: #c678dd;">$&</span>'); // Purple Keywords
    code = code.replace(/"(.*?)"/g, '<span style="color: #98c379;">$&</span>'); // Green Strings
    code = code.replace(/\b(db|client|users|error|doc)\b/g, '<span style="color: #61afef;">$&</span>'); // Blue Variables
    code = code.replace(/\/\/.*/g, '<span style="color: #5c6370;">$&</span>'); // Gray Comments
    code = code.replace(/([a-zA-Z0-9_]+)\./g, '<span style="color: #e5c07b;">$&</span>'); // Yellow Methods
    return code;
};

export default function Docs() {
  const sections = [
    { title: 'Getting Started', items: ['Introduction', 'Installation', 'Authentication'] },
    { title: 'Core Data API', items: ['Collections & Documents', 'Basic CRUD Operations', 'Advanced Filtering & Sorting', 'Trash Bin & Restore'] },
    { title: 'Developer Tools', items: ['API Keys & Permissions', 'Webhooks Integration', 'Playground & Aggregation'] },
    { title: 'SDK Reference', items: ['JavaScript SDK', 'Error Handling'] },
  ];

  // KOMPONEN CODE BLOCK BARU (Menggunakan dangerouslySetInnerHTML)
  const CodeBlock = ({ language, children }) => {
    const highlightedCode = getHighlightedCode(children);
    return (
      <div className="bg-[#050505] rounded-lg border border-white/10 p-4 overflow-x-auto my-4">
        <pre className="font-mono text-sm" style={{color: '#abb2bf', whiteSpace: 'pre-wrap'}}>
           <code 
             className={`language-${language}`} 
             dangerouslySetInnerHTML={{ __html: highlightedCode }} 
           />
        </pre>
      </div>
    );
  };

  const SectionTitle = ({ id, icon: Icon, children }) => (
    <h2 id={id} className="text-3xl font-bold text-white mt-12 mb-6 flex items-center gap-3 border-b border-white/10 pb-3">
      <Icon className="text-sky-400 shrink-0" size={24} /> {children}
    </h2>
  );

  return (
    <div className="min-h-screen bg-background pt-20 flex max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 gap-12">
      
      {/* Sidebar Navigation */}
      <aside className="hidden lg:block w-64 shrink-0 py-8 sticky top-20 h-[calc(100vh-5rem)] overflow-y-auto">
        <div className="space-y-8">
          {sections.map((section) => (
            <div key={section.title}>
              <h5 className="mb-3 font-semibold text-white tracking-wide text-sm uppercase opacity-90">
                {section.title}
              </h5>
              <ul className="space-y-2">
                {section.items.map((item) => {
                  const id = item.toLowerCase().replace(/[^a-z0-9]/g, '-');
                  return (
                    <li key={item}>
                      <a href={`#${id}`} className="block text-sm text-textMuted hover:text-sky-400 transition-colors border-l border-white/5 pl-4 hover:border-sky-400">
                        {item}
                      </a>
                    </li>
                  );
                })}
              </ul>
            </div>
          ))}
        </div>
      </aside>

      {/* Main Content */}
      <main className="flex-1 py-8 min-w-0">
        
        <div className="mb-12 border-b border-white/10 pb-10">
          <h1 className="text-4xl font-bold text-white mb-4">WanzDB Documentation</h1>
          <p className="text-xl text-gray-400">The comprehensive guide to integrating WanzDB into your Node.js, Python, or PHP applications.</p>
        </div>

        {/* ======================= SECTION 1: GETTING STARTED ======================= */}
        <SectionTitle id="introduction" icon={Book}>Getting Started</SectionTitle>
        <p className="text-gray-400 mb-6 leading-relaxed">
          WanzDB adalah database JSON serverless yang dirancang untuk kecepatan tinggi dan skalabilitas instan. Berbeda dengan database tradisional, WanzDB mengurus semua konfigurasi jaringan, sharding, dan failover, memungkinkan Anda berfokus penuh pada logika bisnis aplikasi Anda. Arsitektur kami yang **Global-First** menjamin latensi yang minim untuk pengguna di seluruh dunia.
        </p>

        <h3 id="installation" className="text-2xl font-bold text-white mt-8 mb-4 flex items-center gap-2">
            <Terminal className="text-gray-500" size={20} /> Installation
        </h3>
        <p className="text-gray-400 mb-4">WanzDB dirilis sebagai NPM package ringan. Gunakan manajer paket favorit Anda:</p>
        <CodeBlock language="bash">
          npm install wanzdb
        </CodeBlock>

        <h3 id="authentication" className="text-2xl font-bold text-white mt-8 mb-4 flex items-center gap-2">
            <Key className="text-gray-500" size={20} /> Authentication
        </h3>
        <p className="text-gray-400 mb-4">Autentikasi menggunakan Connection String standar, di mana **Password** Anda adalah **Unique User ID (UUID)** yang berfungsi sebagai **API Key** rahasia. Ini menghilangkan kebutuhan untuk mengirim password asli (bcrypt hash) melalui API, meningkatkan keamanan.</p>
        <CodeBlock language="javascript">
          const {'{ Client }'} = require('wanzdb');

          // Format: wanzdb://<USERNAME>:<UUID_KEY>@dbw-nu.vercel.app
          const db = new Client("wanzdb://{'<USERNAME>'}:{'<UUID_KEY>'}@dbw-nu.vercel.app");
          
          await db.connect();
        </CodeBlock>


        {/* ======================= SECTION 2: CORE DATA API ======================= */}
        <SectionTitle id="core-data-api" icon={Database}>Core Data API</SectionTitle>
        <p className="text-gray-400 mb-6 leading-relaxed">
          Semua operasi data dilakukan melalui objek client.collection('nama_koleksi'). Koleksi dibuat secara otomatis saat Anda melakukan insert pertama kali, dan data Anda diisolasi secara ketat berdasarkan User ID (UID) Anda untuk mencegah kebocoran data antar pengguna.
        </p>
        
        <h3 id="basic-crud-operations" className="text-2xl font-bold text-white mt-8 mb-4">Basic CRUD Operations</h3>
        <CodeBlock language="javascript">
          const users = client.collection('users');
          
          // INSERT: Auto generates 50-char ID
          const newUser = await users.insert({'{} email: "ali@wanz.dev" {}'});
          
          // FIND: Ambil semua
          const allUsers = await users.find({});
          
          // UPDATE: Update by ID
          await users.update(newUser._id, {'{} status: "active" {}'});
        </CodeBlock>
        
        <h3 id="trash-bin-restore" className="text-2xl font-bold text-white mt-8 mb-4">Trash Bin & Restore</h3>
        <p className="text-gray-400 mb-4">Operasi delete adalah **Soft Delete** secara default. Dokumen dipindahkan ke Trash Bin dan dapat dipulihkan hingga Anda melakukan *Empty Trash* permanen.</p>
        <CodeBlock language="javascript">
          // SOFT DELETE: Pindah ke Trash Bin
          await users.delete(userId);
          
          // RESTORE: Mengembalikan dokumen dari Trash
          await client.trash.restore('users', userId);
        </CodeBlock>

        <h3 id="advanced-filtering-sorting" className="text-2xl font-bold text-white mt-8 mb-4">Advanced Filtering & Sorting</h3>
        <p className="text-gray-400 mb-4">WanzDB mendukung operator query lanjutan melalui parameter objek. Anda bisa melakukan sorting (sertakan `-` untuk DESC) dan filtering logis.</p>
        <CodeBlock language="javascript">
          const users = client.collection('users');
          const seniorUsers = await users.find({
            age: { gt: 20 },
            role: "admin"
          }, { sort: "-age", limit: 10 });
        </CodeBlock>


        {/* ======================= SECTION 3: DEVELOPER TOOLS ======================= */}
        <SectionTitle id="developer-tools" icon={HardHat}>Developer Tools</SectionTitle>

        <h3 id="api-keys-permissions" className="text-2xl font-bold text-white mt-8 mb-4">API Keys & Permissions</h3>
        <p className="text-gray-400 mb-6">Kelola akses data Anda secara granular. Anda dapat membuat API Key terpisah untuk lingkungan *development* dan *production*, serta membatasi Key tersebut hanya untuk operasi **READ** atau **READ/WRITE** pada koleksi tertentu melalui Console Dashboard.</p>

        <h3 id="webhooks-integration" className="text-2xl font-bold text-white mt-8 mb-4">Webhooks Integration</h3>
        <p className="text-gray-400 mb-6">Daftarkan URL Webhook di Dashboard untuk menerima notifikasi *real-time* saat terjadi event seperti document.created atau document.updated. Fitur ini sangat penting untuk membangun arsitektur *event-driven* atau sinkronisasi data antar layanan mikro (microservices).</p>

        <h3 id="playground-aggregation" className="text-2xl font-bold text-white mt-8 mb-4">Playground & Aggregation</h3>
        <p className="text-gray-400 mb-6">Gunakan Playground Console untuk menguji query dan aggregation pipeline secara langsung. Ini mendukung sintaks MongoDB MQL penuh untuk operasi data yang kompleks dan visualisasi data sebelum diimplementasikan di kode Anda.</p>

        {/* ======================= SECTION 4: SDK REFERENCE ======================= */}
        <SectionTitle id="sdk-reference" icon={Code2}>SDK Reference</SectionTitle>

        <h3 id="javascript-sdk" className="text-2xl font-bold text-white mt-8 mb-4">JavaScript SDK</h3>
        <p className="text-gray-400 mb-4">SDK kami dirancang untuk kompatibilitas penuh dengan lingkungan Node.js dan browser. Semua method mengembalikan Promise. Anda dapat menggunakan sintaks async/await yang modern.</p>
        <CodeBlock language="javascript">
          const {'{ Client }'} = require('wanzdb');

          async function getUser() {'{'}
            const client = new Client("wanzdb://user:key@host");
            await client.connect();
            
            const users = client.collection('users');
            const doc = await users.findOne({'{} email: "test@example.com" {}'});

            return doc;
          {'}'}
        </CodeBlock>

        <h3 id="error-handling" className="text-2xl font-bold text-white mt-8 mb-4">Error Handling</h3>
        <p className="text-gray-400 mb-4">Semua method SDK mengembalikan Promise. Anda harus menggunakan blok try...catch untuk menangani kegagalan jaringan, validasi, atau otentikasi.</p>
        <CodeBlock language="javascript">
          try {'{'}
            await client.collection('protected').insert({'{} data: true {'}'});
          {'}'} catch (error) {'{'}
            console.error(`Error Code: ${error.message}`);
          {'}'}
        </CodeBlock>
      </main>
    </div>
  );
}